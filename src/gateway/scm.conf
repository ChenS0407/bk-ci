	# scm接口
	location ~ /api {
		# 设置scm-server名称
		set_by_lua_block $domain {
			local domain = ngx.var.host

			if (string.match(domain, '^scm%.devops%.') ~= nil) then
				return "scm-server"
			end
			if (string.match(domain, '^dev%.scm%.') ~= nil) then
				return "dev-scm-server"
			end
			if (string.match(domain, '^test%.scm%.') ~= nil) then
				return "test-scm-server"
			end
			if (string.match(domain, '^gray%.scm%.') ~= nil) then
				return "gray-scm-server"
			end
			return "scm-server"
    	}
		
		# 设置proxy header的变量
		include proxy.set.header.conf;

		# 代理到scm的机器上
		proxy_pass http://$domain;
	}